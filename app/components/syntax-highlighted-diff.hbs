<div class="relative">
  <div class="py-4 overflow-x-scroll" ...attributes>
    <div class="min-w-fit">
      {{#each this.linesForRender key="number" as |line|}}
        {{log this.lineElementTopOffsetMap.size}}
        {{! prettier-ignore }}
        <pre class="shiki github-light min-w-fit" {{did-insert (fn this.handleDidInsertLine line)}}>{{!
        }}<code class="block diff-highlight min-w-fit">{{!
          }}<div class="px-2 {{line.type}}-line min-w-fit">{{!
            }}{{#if (eq line.type "added")}}{{!
                }}<span class="inserted-marker select-none">+ </span>{{!
              }}{{else if (eq line.type "removed")}}{{!
                }}<span class="removed-marker select-none">- </span>{{!
              }}{{else}}{{!
                }}<span class="unchanged-marker select-none">  </span>{{!
              }}{{/if}}{{!
            }}{{line.html}}{{!
          }}</div>{{!
        }}</code>{{!
      }}</pre>

        {{#if (and line.commentsAreExpanded line.hasComments)}}
          <div class="py-2 my-4 border-t border-b space-y-4 px-4">
            {{#if line.commentsAreExpanded}}
              {{#each line.comments key="id" as |comment|}}
                <CoursePage::CourseStageSolutionModal::CommentTimelineItem @author={{comment.user}}>
                  <div class="shadow-sm rounded border border-gray-300 w-full">
                    <CommentCard @comment={{comment}} />
                  </div>
                </CoursePage::CourseStageSolutionModal::CommentTimelineItem>
              {{/each}}
            {{/if}}
          </div>
        {{/if}}
      {{/each}}
    </div>
    {{#each this.topLevelCommentsForRender as |commentForRender|}}
      <div class="absolute right-0 flex items-stretch justify-stretch" style={{commentForRender.containerStyle}}>
        <div class="relative w-0.5 {{if commentForRender.isExpanded 'bg-teal-500' 'bg-gray-300'}}">
          <div class="absolute right-2 bottom-[-5px] z-10">
            <SyntaxHighlightedDiff::ToggleCommentsButton
              @commentsAreExpanded={{commentForRender.isExpanded}}
              {{on "click" (fn this.handleToggleCommentsButtonClick commentForRender.comment)}}
            />
          </div>
        </div>
      </div>
    {{/each}}
  </div>
</div>